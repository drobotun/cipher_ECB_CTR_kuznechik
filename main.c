#include "files.h"

static unsigned char test_key[32] = {
    0xef, 0xcd, 0xab, 0x89, 0x67, 0x45, 0x23, 0x01, 0x10, 0x32, 0x54, 0x76, 0x98, 0xba, 0xdc, 0xfe,
    0x77, 0x66, 0x55, 0x44, 0x33, 0x22, 0x11, 0x00, 0xff, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99, 0x88
};


static unsigned char
encrypt_test_string[64] =
{
    0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff, 0x00, 0x77, 0x66, 0x55, 0x44, 0x33, 0x22, 0x11,
    0x0a, 0xff, 0xee, 0xcc, 0xbb, 0xaa, 0x99, 0x88, 0x77, 0x66, 0x55, 0x44, 0x33, 0x22, 0x11, 0x00,
    0x00, 0x0a, 0xff, 0xee, 0xcc, 0xbb, 0xaa, 0x99, 0x88, 0x77, 0x66, 0x55, 0x44, 0x33, 0x22, 0x11,
    0x11, 0x00, 0x0a, 0xff, 0xee, 0xcc, 0xbb, 0xaa, 0x99, 0x88, 0x77, 0x66, 0x55, 0x44, 0x33, 0x22
};

static unsigned char
decrypt_test_string_ECB[64] =
{
    0xcd, 0xed, 0xd4, 0xb9, 0x42, 0x8d, 0x46, 0x5a, 0x30, 0x24, 0xbc, 0xbe, 0x90, 0x9d, 0x67, 0x7f,
    0x8b, 0xd0, 0x18, 0x67, 0xd7, 0x52, 0x54, 0x28, 0xf9, 0x32, 0x00, 0x6e, 0x2c, 0x91, 0x29, 0xb4,
    0x57, 0xb1, 0xd4, 0x3b, 0x31, 0xa5, 0xf5, 0xf3, 0xee, 0x7c, 0x24, 0x9d, 0x54, 0x33, 0xca, 0xf0,
    0x98, 0xda, 0x8a, 0xaa, 0xc5, 0xc4, 0x02, 0x3a, 0xeb, 0xb9, 0x30, 0xe8, 0xcd, 0x9c, 0xb0, 0xd0
};

static unsigned char
init_vect_ctr_string[BLCK_SIZE / 2] =
{
    0x78, 0x56, 0x34, 0x12
};

const char *in_file_name = "test_kuz.txt";
const char *out_file_ECB_name = "encrypt_test_ECB.txt";
const char *out_file_CTR_name = "encrypt_test_CTR.txt";

static void
print_cipher_blck(uint8_t *state, uint64_t size)
{
    unsigned int i;
    for (i = 0; i < size; i++)
        printf("%02x", state[i]);
    printf("\n");
}

int main()
{
    uint8_t out_buf[64];
    ECB_Encrypt(encrypt_test_string, out_buf, test_key, 64);
    printf("Text:\n");
    print_cipher_blck(encrypt_test_string, 64);
    printf("ECB encrypted  text:\n");
    print_cipher_blck(out_buf, 64);

    ECB_Decrypt(decrypt_test_string_ECB, out_buf, test_key, 32);
    printf("ECB cipher text:\n");
    print_cipher_blck(decrypt_test_string_ECB, 64);
    printf("ECB decrypted  text:\n");
    print_cipher_blck(out_buf, 64);

    FILE *in_file = fopen(in_file_name, "rb");
    if (in_file == NULL)
    {
        printf("Error opening file: %s\n", in_file_name);
        return -1;
    }
    FILE *out_file_ECB = fopen(out_file_ECB_name, "wb");
    if (out_file_ECB == NULL)
    {
        printf("Error opening file: %s\n", out_file_ECB_name);
        return -1;
    }
    FILE *out_file_CTR = fopen(out_file_CTR_name, "wb");
    if (out_file_CTR == NULL)
    {
        printf("Error opening file: %s\n", out_file_CTR_name);
        return -1;
    }

    ECB_Encrypt_File(in_file, out_file_ECB, test_key, get_size_file(in_file), PAD_MODE_1);
    CTR_Crypt_File(in_file, out_file_CTR, init_vect_ctr_string, test_key, get_size_file(in_file));
    fclose(in_file);
    fclose(out_file_ECB);
    fclose(out_file_CTR);
    printf("Encryption file complete\n");
    return 0;
}
